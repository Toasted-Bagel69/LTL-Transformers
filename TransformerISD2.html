<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformer Monitoring Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f4f6;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            gap: 25px;
            align-items: center;
            font-size: 14px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-dot.connected {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
            animation: pulse 2s infinite;
        }
        
        .status-dot.disconnected {
            background: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            width: 380px;
            background: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid #e5e7eb;
            background: #f9fafb;
        }
        
        .sidebar-header h2 {
            color: #1e3c72;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .add-transformer-btn {
            width: 100%;
            padding: 10px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .add-transformer-btn:hover {
            background: #1d4ed8;
        }
        
        .transformer-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .transformer-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .transformer-card:hover {
            border-color: #2563eb;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
        }
        
        .transformer-card.normal {
            border-left: 4px solid #10b981;
        }
        
        .transformer-card.critical {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .card-title {
            font-weight: bold;
            color: #1f2937;
            font-size: 16px;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.normal {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .card-info {
            font-size: 13px;
            color: #6b7280;
        }
        
        .card-info div {
            margin-bottom: 4px;
        }
        
        .alert-details {
            margin-top: 10px;
            padding: 8px;
            background: #fff7ed;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .alert-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .alert-label {
            font-weight: 600;
        }
        
        .alert-value.critical {
            color: #dc2626;
            font-weight: 600;
        }
        
        .alert-value.normal {
            color: #16a34a;
        }
        
        .card-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .btn-edit:hover {
            background: #bfdbfe;
        }
        
        .btn-delete {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .btn-delete:hover {
            background: #fecaca;
        }
        
        #map {
            flex: 1;
        }
        
        .modal {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            transition: right 0.3s ease-in-out;
            overflow-y: auto;
        }
        
        .modal.active {
            right: 0;
        }
        
        .modal-content {
            padding: 30px;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .modal-overlay.active {
            display: block;
            opacity: 1;
        }
        
        .modal-header {
            font-size: 22px;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2563eb;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #d1d5db;
        }
        
        .leaflet-popup-content {
            min-width: 250px;
        }
        
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: #1e3c72;
        }
        
        .popup-info {
            font-size: 13px;
            color: #4b5563;
            line-height: 1.6;
        }
        
        .custom-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 4px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .marker-normal {
            background: #10b981;
        }
        
        .marker-critical {
            background: #ef4444;
            animation: marker-pulse 1s infinite;
        }
        
        @keyframes marker-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 4px 20px rgba(239, 68, 68, 0.8);
            }
        }

        .helper-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .info-box {
            background: #f0f9ff;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 3px solid #2563eb;
        }

        .info-box strong {
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Transformer Monitoring System</h1>
        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot" id="mqtt-status"></div>
                <span id="mqtt-text">Connecting to MQTT...</span>
            </div>
            <div class="status-item">
                <span>Total: <strong id="total-count">0</strong></span>
            </div>
            <div class="status-item">
                <span>üü¢ Normal: <strong id="normal-count">0</strong></span>
            </div>
            <div class="status-item">
                <span>üî¥ Critical: <strong id="critical-count">0</strong></span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Transformers</h2>
                <button class="add-transformer-btn" onclick="openModal()">+ Add Transformer</button>
            </div>
            <div class="transformer-list" id="transformer-list">
                <!-- Transformer cards will be added here -->
            </div>
        </div>

        <div id="map"></div>
    </div>

    <!-- Overlay for modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal()"></div>

    <!-- Slider panel for adding/editing transformer -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modal-title">Add Transformer</span>
                <button type="button" class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="info-box">
                <strong>Topic Format:</strong> methma/transformers/{location}/{id}/{type}<br>
                Example: methma/transformers/MainStation/T1/temperature
            </div>

            <form id="transformer-form">
                <div class="form-group">
                    <label>Transformer ID * (e.g., T1, T2, T3)</label>
                    <input type="text" id="input-id" placeholder="T1" required>
                    <div class="helper-text">Must match the TRANSFORMER_ID in ESP32 code</div>
                </div>
                <div class="form-group">
                    <label>Transformer Name *</label>
                    <input type="text" id="input-name" placeholder="e.g., Main Station A" required>
                </div>
                <div class="form-group">
                    <label>Location Code * (e.g., MainStation, SubstationB)</label>
                    <input type="text" id="input-location-code" placeholder="MainStation" required>
                    <div class="helper-text">Must match the LOCATION in ESP32 code (no spaces)</div>
                </div>
                <div class="form-group">
                    <label>Location Description</label>
                    <input type="text" id="input-location-desc" placeholder="e.g., Industrial Zone">
                </div>
                <div class="form-group">
                    <label>Latitude *</label>
                    <input type="number" step="0.000001" id="input-lat" placeholder="e.g., 7.2088" required>
                    <div class="helper-text">Decimal format (e.g., 7.2088 for Negombo, Sri Lanka)</div>
                </div>
                <div class="form-group">
                    <label>Longitude *</label>
                    <input type="number" step="0.000001" id="input-lng" placeholder="e.g., 79.8358" required>
                    <div class="helper-text">Decimal format (e.g., 79.8358 for Negombo, Sri Lanka)</div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let map;
        let markers = {};
        let transformers = [];
        let editingId = null;
        let client;

        // Initialize map centered on Sri Lanka
        function initMap() {
            map = L.map('map').setView([7.8731, 80.7718], 8);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Load saved transformers
            loadTransformers();
        }

        // Create custom marker
        function createCustomMarker(status) {
            const className = status === 'normal' ? 'marker-normal' : 'marker-critical';
            return L.divIcon({
                html: `<div class="custom-marker ${className}">‚ö°</div>`,
                className: 'custom-div-icon',
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });
        }

        // Add transformer to map
        function addTransformerToMap(transformer) {
            const marker = L.marker([transformer.lat, transformer.lng], {
                icon: createCustomMarker(transformer.status)
            }).addTo(map);

            const popupContent = `
                <div class="popup-title">${transformer.name} (${transformer.transformerId})</div>
                <div class="popup-info">
                    <strong>Location:</strong> ${transformer.locationDesc || transformer.locationCode}<br>
                    <strong>Overall Status:</strong> ${transformer.status === 'normal' ? 'üü¢ Normal' : 'üî¥ Critical'}<br>
                    <strong>Temperature:</strong> ${transformer.tempStatus || 'N/A'}<br>
                    <strong>Pressure:</strong> ${transformer.pressureStatus || 'N/A'}<br>
                    <strong>Gas:</strong> ${transformer.gasStatus || 'N/A'}<br>
                    <strong>Last Update:</strong> ${transformer.lastUpdate || 'N/A'}<br>
                    <strong>Coordinates:</strong> ${transformer.lat.toFixed(4)}, ${transformer.lng.toFixed(4)}
                </div>
            `;
            
            marker.bindPopup(popupContent);
            markers[transformer.id] = marker;
        }

        // Update transformer status based on sensor type
        function updateTransformerSensorStatus(transformerId, locationCode, sensorType, isCritical) {
            const transformer = transformers.find(t => 
                t.transformerId === transformerId && t.locationCode === locationCode
            );
            
            if (transformer) {
                // Update specific sensor status
                if (sensorType === 'temperature') {
                    transformer.tempStatus = isCritical ? 'üî¥ Critical' : 'üü¢ Normal';
                } else if (sensorType === 'pressure') {
                    transformer.pressureStatus = isCritical ? 'üî¥ Critical' : 'üü¢ Normal';
                } else if (sensorType === 'gas') {
                    transformer.gasStatus = isCritical ? 'üî¥ Critical' : 'üü¢ Normal';
                }
                
                // Update overall status (critical if ANY sensor is critical)
                transformer.status = (
                    transformer.tempStatus?.includes('Critical') ||
                    transformer.pressureStatus?.includes('Critical') ||
                    transformer.gasStatus?.includes('Critical')
                ) ? 'critical' : 'normal';
                
                transformer.lastUpdate = new Date().toLocaleString();
                
                // Update marker
                if (markers[transformer.id]) {
                    markers[transformer.id].setIcon(createCustomMarker(transformer.status));
                    
                    const popupContent = `
                        <div class="popup-title">${transformer.name} (${transformer.transformerId})</div>
                        <div class="popup-info">
                            <strong>Location:</strong> ${transformer.locationDesc || transformer.locationCode}<br>
                            <strong>Overall Status:</strong> ${transformer.status === 'normal' ? 'üü¢ Normal' : 'üî¥ Critical'}<br>
                            <strong>Temperature:</strong> ${transformer.tempStatus || 'N/A'}<br>
                            <strong>Pressure:</strong> ${transformer.pressureStatus || 'N/A'}<br>
                            <strong>Gas:</strong> ${transformer.gasStatus || 'N/A'}<br>
                            <strong>Last Update:</strong> ${transformer.lastUpdate}
                        </div>
                    `;
                    markers[transformer.id].setPopupContent(popupContent);
                }
                
                saveTransformers();
                renderTransformerList();
                updateCounts();
            }
        }

        // Render transformer list in sidebar
        function renderTransformerList() {
            const listContainer = document.getElementById('transformer-list');
            listContainer.innerHTML = '';

            transformers.forEach(transformer => {
                const card = document.createElement('div');
                card.className = `transformer-card ${transformer.status}`;
                card.onclick = () => {
                    map.setView([transformer.lat, transformer.lng], 15);
                    markers[transformer.id].openPopup();
                };

                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${transformer.name} (${transformer.transformerId})</div>
                        <div class="status-badge ${transformer.status}">
                            ${transformer.status === 'normal' ? '‚úì Normal' : '‚ö† Critical'}
                        </div>
                    </div>
                    <div class="card-info">
                        <div>üìç ${transformer.locationDesc || transformer.locationCode}</div>
                        <div>üìä Base Topic: methma/transformers/${transformer.locationCode}/${transformer.transformerId}</div>
                        <div>üïí ${transformer.lastUpdate || 'No updates'}</div>
                    </div>
                    <div class="alert-details">
                        <div class="alert-item">
                            <span class="alert-label">üå°Ô∏è Temperature:</span>
                            <span class="alert-value ${transformer.tempStatus?.includes('Critical') ? 'critical' : 'normal'}">
                                ${transformer.tempStatus || 'N/A'}
                            </span>
                        </div>
                        <div class="alert-item">
                            <span class="alert-label">üí® Pressure:</span>
                            <span class="alert-value ${transformer.pressureStatus?.includes('Critical') ? 'critical' : 'normal'}">
                                ${transformer.pressureStatus || 'N/A'}
                            </span>
                        </div>
                        <div class="alert-item">
                            <span class="alert-label">‚öóÔ∏è Gas:</span>
                            <span class="alert-value ${transformer.gasStatus?.includes('Critical') ? 'critical' : 'normal'}">
                                ${transformer.gasStatus || 'N/A'}
                            </span>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn-small btn-edit" onclick="event.stopPropagation(); editTransformer('${transformer.id}')">Edit</button>
                        <button class="btn-small btn-delete" onclick="event.stopPropagation(); deleteTransformer('${transformer.id}')">Delete</button>
                    </div>
                `;

                listContainer.appendChild(card);
            });
        }

        // Update counts
        function updateCounts() {
            const total = transformers.length;
            const critical = transformers.filter(t => t.status === 'critical').length;
            const normal = total - critical;

            document.getElementById('total-count').textContent = total;
            document.getElementById('normal-count').textContent = normal;
            document.getElementById('critical-count').textContent = critical;
        }

        // Modal functions
        function openModal(transformer = null) {
            editingId = transformer ? transformer.id : null;
            const modal = document.getElementById('modal');
            const overlay = document.getElementById('modal-overlay');
            const form = document.getElementById('transformer-form');
            
            if (transformer) {
                document.getElementById('modal-title').textContent = 'Edit Transformer';
                document.getElementById('input-id').value = transformer.transformerId;
                document.getElementById('input-name').value = transformer.name;
                document.getElementById('input-location-code').value = transformer.locationCode;
                document.getElementById('input-location-desc').value = transformer.locationDesc || '';
                document.getElementById('input-lat').value = transformer.lat;
                document.getElementById('input-lng').value = transformer.lng;
            } else {
                document.getElementById('modal-title').textContent = 'Add Transformer';
                form.reset();
            }
            
            // Trigger slide animation
            overlay.classList.add('active');
            setTimeout(() => {
                modal.classList.add('active');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const overlay = document.getElementById('modal-overlay');
            
            modal.classList.remove('active');
            setTimeout(() => {
                overlay.classList.remove('active');
                editingId = null;
            }, 300);
        }

        // Save transformer
        document.getElementById('transformer-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const transformerId = document.getElementById('input-id').value.trim();
            const locationCode = document.getElementById('input-location-code').value.trim();
            
            const transformer = {
                id: editingId || 'id-' + Date.now(),
                transformerId: transformerId,
                name: document.getElementById('input-name').value,
                locationCode: locationCode,
                locationDesc: document.getElementById('input-location-desc').value,
                lat: parseFloat(document.getElementById('input-lat').value),
                lng: parseFloat(document.getElementById('input-lng').value),
                status: 'normal',
                tempStatus: 'üü¢ Normal',
                pressureStatus: 'üü¢ Normal',
                gasStatus: 'üü¢ Normal',
                lastUpdate: null
            };

            if (editingId) {
                const index = transformers.findIndex(t => t.id === editingId);
                if (markers[editingId]) {
                    map.removeLayer(markers[editingId]);
                    delete markers[editingId];
                }
                transformers[index] = transformer;
            } else {
                transformers.push(transformer);
                
                // Subscribe to all sensor topics for this transformer
                if (client && client.isConnected()) {
                    const baseTopic = `methma/transformers/${locationCode}/${transformerId}`;
                    client.subscribe(`${baseTopic}/temperature`);
                    client.subscribe(`${baseTopic}/pressure`);
                    client.subscribe(`${baseTopic}/gas`);
                    client.subscribe(`${baseTopic}/status`);
                    console.log('Subscribed to topics for:', transformerId);
                }
            }

            addTransformerToMap(transformer);
            saveTransformers();
            renderTransformerList();
            updateCounts();
            closeModal();
            
            map.setView([transformer.lat, transformer.lng], 15);
        });

        // Edit transformer
        function editTransformer(id) {
            const transformer = transformers.find(t => t.id === id);
            if (transformer) {
                openModal(transformer);
            }
        }

        // Delete transformer
        function deleteTransformer(id) {
            if (confirm('Are you sure you want to delete this transformer?')) {
                transformers = transformers.filter(t => t.id !== id);
                if (markers[id]) {
                    map.removeLayer(markers[id]);
                    delete markers[id];
                }
                saveTransformers();
                renderTransformerList();
                updateCounts();
            }
        }

        // Local storage
        function saveTransformers() {
            localStorage.setItem('transformers', JSON.stringify(transformers));
        }

        function loadTransformers() {
            const saved = localStorage.getItem('transformers');
            if (saved) {
                transformers = JSON.parse(saved);
                transformers.forEach(t => addTransformerToMap(t));
                renderTransformerList();
                updateCounts();
            }
        }

        // MQTT Connection
    function connectMQTT() {
    const clientId = 'web-client-' + Math.random().toString(16).substr(2, 8);

    client = new Paho.MQTT.Client(
        "broker.hivemq.com",
        Number(8884),      // Secure WebSocket
        "/mqtt",           // üî¥ REQUIRED PATH
        clientId
    );

    client.onConnectionLost = (responseObject) => {
        console.error("MQTT connection lost:", responseObject.errorMessage);
        document.getElementById('mqtt-status').className = 'status-dot disconnected';
        document.getElementById('mqtt-text').textContent = 'MQTT Disconnected';
    };

    client.onMessageArrived = (message) => {
        console.log("MQTT message:", message.destinationName, message.payloadString);

        const topicParts = message.destinationName.split('/');
        if (topicParts.length !== 5) return;

        const locationCode = topicParts[2];
        const transformerId = topicParts[3];
        const sensorType = topicParts[4];

        try {
            const data = JSON.parse(message.payloadString);
            const isCritical = data.status === "critical";

            updateTransformerSensorStatus(
                transformerId,
                locationCode,
                sensorType,
                isCritical
            );
        } catch (e) {
            console.warn("Invalid JSON payload");
        }
    };

    client.connect({
        useSSL: true,
        cleanSession: true,
        timeout: 15,

        onSuccess: () => {
            console.log("‚úÖ MQTT CONNECTED (HiveMQ WSS)");
            document.getElementById('mqtt-status').className = 'status-dot connected';
            document.getElementById('mqtt-text').textContent = 'MQTT Connected';

            // Subscribe to ALL transformers
            client.subscribe("methma/transformers/+/+/+");
            console.log("Subscribed to methma/transformers/+/+/+");
        },

        onFailure: (error) => {
            console.error("‚ùå MQTT CONNECTION FAILED", error);
            document.getElementById('mqtt-status').className = 'status-dot disconnected';
            document.getElementById('mqtt-text').textContent = 'Connection Failed';
        }
    });
}


        // Initialize
        window.onload = () => {
            initMap();
            connectMQTT();
        };
    </script>
</body>

</html>


